colorComponent = "Genotype",pchComponent = "Time"
)
test
mean = pctable %>% dplyr::select(PC1,PC2,PC3,Genotype) %>%
dplyr::group_by(Genotype) %>%
dplyr::summarise(PC1 = mean(PC1) ,PC2 = mean(PC2), PC3 = mean(PC3) )
# Changes here to include PC1
origo = data.frame(PC1=0,PC2=0, PC3 = 0)
line.gd7 = rbind(mean[1,2:4],origo,-mean[1,2:4])
line.gd7$factor = "Gd7"
line.toll10b = rbind(mean[2,2:4],origo,-mean[2,2:4])
line.toll10b$factor = "Toll10b"
line.toll9 = rbind(mean[3,2:4],origo,-mean[3,2:4])
line.toll9$factor = "Toll9"
line = rbind(line.gd7,line.toll10b,line.toll9)
ggplot(line, mapping = aes(x = PC2,y = PC3, color = factor))+ geom_line() + geom_point(data = pctable,  mapping = aes(x = PC2,y = PC3, color = Genotype, shape = Time))
loadings =mir.pca$rotation[,1:3]
loadings1 = as.data.frame(t((t(loadings)-colMeans(loadings))/colSds(loadings)))
loadings1$Geneid = rownames(loadings)
#loadings1 = as.data.frame(loadings)
distance3d <- function(a,b){
v1 = a - b
distance = ((v1[[1]]^2 + v1[[2]]^2 + v1[[3]]^2)^0.5)
return(distance)
}
dist3d <- function(point,b,c) {
v1 <- b - c
v2 <- point - b
v3 <- cross3d_prod(v1,v2)
area <- sqrt(sum(v3*v3))/2
d <- 2*area/sqrt(sum(v1*v1))
return(d)
}
cross3d_prod <- function(v1,v2){
v3 <- vector()
v3[1] <- v1[2]*v2[3]-v1[3]*v2[2]
v3[2] <- v1[3]*v2[1]-v1[1]*v2[3]
v3[3] <- v1[1]*v2[2]-v1[2]*v2[1]
return(v3)
}
for(j in unique(line$factor)){
loadings1[[j]]=0
for(i in 1:nrow(loadings1)){
line1 = line %>% dplyr::filter(factor == j) %>% dplyr::select(PC1,PC2,PC3)
loadings1[i,j] = dist3d(b =as.numeric(line1[1,]),
c = as.numeric(line1[3,]),
point = as.numeric(loadings1[i,1:3]))
}
}
knitr::opts_chunk$set(echo = TRUE)
# Install required packages
#install.packages("kableExtra")
#install.packages("tidyverse")
#install.packages("RColorBrewer")
# Include the functions from the expression analysis script
source(paste(params$workingDir, params$RscriptsDir,"ExpressionAnalysisFunctions.r", sep = "/"))
library(tidyverse)
library(gplots)
library(kableExtra)
library(DESeq2)
library("viridis")
# Read in the ATACseq count data
featureCountFile = paste(params$workingDir, params$dataDir,params$count_ATAC, sep = "/")
FCdata = read.table( file = featureCountFile, header = TRUE, sep = "\t", quote = "", stringsAsFactors = FALSE)
# Save the columns with info in peak info
peakInfo  = FCdata [,1:6]
# Save the count data info in table countData
countData = FCdata[,-1:-6]
# Change row names to geneID which is saved in peakInfo
rownames(countData) = peakInfo$Geneid
# Load the sample data
sampleInfoFile = paste(params$workingDir, params$sampleInfo, sep = "/")
sampleInfo = read.table(
file = sampleInfoFile,
header = TRUE,
sep = "\t",
quote = "",
stringsAsFactors = FALSE
)
sampleInfo$bamFiles2  =  gsub(pattern = "/",
replacement = ".",
x = sampleInfo$bamFiles)
sampleInfo$bamFiles2  =  gsub(pattern = "-",
replacement = ".",
x = sampleInfo$bamFiles2)
# Rename the mutants in sampledata so that the names are universal for the data
sampleInfo$Genotype = recode(sampleInfo$Genotype, Toll910 = "Toll9")
sampleInfo$Genotype = recode(sampleInfo$Genotype, `Toll9/10` = "Toll9")
sampleInfo$Genotype = recode(sampleInfo$Genotype, gd7 = "Gd7")
# Filter out the sampleInfo that is not ATACseq
sampleInfo = sampleInfo %>% filter(Assaytype == params$Method)
#sampleInfoCountTable = data.frame(bamFiles2 = colnames(countData))
#sampleInfo = inner_join(sampleInfo, sampleInfoCountTable)
countData = countData[, sampleInfo$bamFiles2]
sampleInfo$Nuclearcycle[is.na(sampleInfo$Nuclearcycle)] = "Mutant"
colnames(countData) = sampleInfo$SampleInfo
fixedSamples = sampleInfo$SampleInfo[grep(pattern = "Fixed", x = sampleInfo$SampleInfo)]
spikedSamples = sampleInfo$SampleInfo[grep(pattern = "spiked", x = sampleInfo$SampleInfo)]
sampleInfo_Mutants = sampleInfo %>% filter(Nuclearcycle == "Mutant") %>%
filter(!SampleInfo %in% fixedSamples) %>%
filter(!SampleInfo %in% spikedSamples)
countData_mutants = countData[, sampleInfo_Mutants$SampleInfo]
exp.data = countData_mutants
metaInfo = sampleInfo_Mutants
rownames(metaInfo) = sampleInfo_Mutants$SampleInfo
metaInfo$Antibody = as.factor(metaInfo$Antibody)
metaInfo$Genotype = as.factor(metaInfo$Genotype)
dds <- DESeqDataSetFromMatrix(countData = exp.data,
colData = metaInfo,
design = ~Genotype )
#Remove rows with low counts and normalise samples for visualisation
dds <- dds[ rowSums(counts(dds)) > 100, ]
dim(dds)
#Normalizing and change to 2 fold log changes.
rld <- rlog(dds)
normExpression = as.data.frame(assay(rld))
normExpression$geneID = rownames(normExpression)
normExpressionDF  = normExpression %>% gather( key = sampleName, value = rlog, -geneID)
#normExpressionDF = inner_join(normExpressionDF, sampleInfo)
ggplot(normExpressionDF, aes(x = rlog, color = sampleName)) + geom_density()
geneInfo = normExpressionDF %>%
dplyr::select(geneID, rlog, sampleName) %>%
dplyr::group_by (geneID) %>%
dplyr::summarize ( min = min(rlog),
max = max(rlog),
mean = mean(rlog),
sd = sd(rlog),
overQC = length(which(rlog > 5))
)
geneInfo.QC2 = geneInfo %>%
filter(overQC > 2)
normExpressionDF.QC = normExpressionDF %>%
filter(geneID %in% geneInfo.QC2$geneID)
ggplot(normExpressionDF.QC, aes(x = rlog, color = sampleName)) + geom_density()
normExpression.QC = normExpressionDF.QC %>%
dplyr::select(geneID, sampleName, rlog) %>%
spread(key = sampleName, value = rlog)
rownames(normExpression.QC) = normExpression.QC$geneID
normExpression.QC = normExpression.QC[, -1]
## Saving sampleInfo File
sampleInfoFile = paste(params$workingDir, params$resultsDir,"ATAC.sampleInfo.QC.tab.txt", sep = "/")
write.table(x = sampleInfo_Mutants,
file = sampleInfoFile,
quote = F,
sep =  "\t",
row.names = F,
col.names = T
)
## Saving peakInfo File
peakInfo_QC = peakInfo %>%
dplyr::rename(geneID = Geneid) %>%
inner_join( geneInfo.QC2)
peakTableFile = paste(params$workingDir, params$resultsDir,"ATAC.CBP.peaks.QC.tab.txt", sep = "/")
write.table(x = peakInfo_QC,
file = peakTableFile,
quote = F,
sep =  "\t",
row.names = F,
col.names = T
)
count_ATAC_QC_File = paste(params$workingDir, params$resultsDir,
paste(params$count_ATAC_QC, sep = "."), sep = "/")
countData.QC = countData_mutants[peakInfo_QC$geneID,
sampleInfo_Mutants$SampleInfo
]
write.table(x = countData.QC,
file = count_ATAC_QC_File,
quote = F,
sep =  "\t",
row.names = T,
col.names = T
)
## Saving normalised count file
NormalisedCountFile = paste(params$workingDir, params$resultsDir,
paste(params$normalisedATACpeakData, sep = "."), sep = "/")
normExpression.QC = normExpression[peakInfo_QC$geneID, sampleInfo_Mutants$SampleInfo]
write.table(x = normExpression.QC, file = NormalisedCountFile,
quote = F, sep = "\t", col.names = T, row.names = T)
knitr::opts_chunk$set(echo = TRUE)
# Install required packages
#install.packages("kableExtra")
#install.packages("tidyverse")
#install.packages("RColorBrewer")
# Include the functions from the expression analysis script
source(paste(params$workingDir, params$RscriptsDir,"ExpressionAnalysisFunctions.r", sep = "/"))
library(tidyverse)
library(gplots)
library(kableExtra)
library(DESeq2)
library("viridis")
# Read in the ATACseq count data
featureCountFile = paste(params$workingDir, params$dataDir,params$count_ATAC, sep = "/")
FCdata = read.table( file = featureCountFile, header = TRUE, sep = "\t", quote = "", stringsAsFactors = FALSE)
# Save the columns with info in peak info
peakInfo  = FCdata [,1:6]
# Save the count data info in table countData
countData = FCdata[,-1:-6]
# Change row names to geneID which is saved in peakInfo
rownames(countData) = peakInfo$Geneid
# Load the sample data
sampleInfoFile = paste(params$workingDir, params$sampleInfo, sep = "/")
sampleInfo = read.table(
file = sampleInfoFile,
header = TRUE,
sep = "\t",
quote = "",
stringsAsFactors = FALSE
)
sampleInfo$bamFiles2  =  gsub(pattern = "/",
replacement = ".",
x = sampleInfo$bamFiles)
sampleInfo$bamFiles2  =  gsub(pattern = "-",
replacement = ".",
x = sampleInfo$bamFiles2)
# Rename the mutants in sampledata so that the names are universal for the data
sampleInfo$Genotype = recode(sampleInfo$Genotype, Toll910 = "Toll9")
sampleInfo$Genotype = recode(sampleInfo$Genotype, `Toll9/10` = "Toll9")
sampleInfo$Genotype = recode(sampleInfo$Genotype, gd7 = "Gd7")
# Filter out the sampleInfo that is not ATACseq
sampleInfo = sampleInfo %>% filter(Assaytype == params$Method)
#sampleInfoCountTable = data.frame(bamFiles2 = colnames(countData))
#sampleInfo = inner_join(sampleInfo, sampleInfoCountTable)
countData = countData[, sampleInfo$bamFiles2]
sampleInfo$Nuclearcycle[is.na(sampleInfo$Nuclearcycle)] = "Mutant"
colnames(countData) = sampleInfo$SampleInfo
fixedSamples = sampleInfo$SampleInfo[grep(pattern = "Fixed", x = sampleInfo$SampleInfo)]
spikedSamples = sampleInfo$SampleInfo[grep(pattern = "spiked", x = sampleInfo$SampleInfo)]
sampleInfo_Mutants = sampleInfo %>% filter(Nuclearcycle == "Mutant") %>%
filter(!SampleInfo %in% fixedSamples) %>%
filter(!SampleInfo %in% spikedSamples)
countData_mutants = countData[, sampleInfo_Mutants$SampleInfo]
exp.data = countData_mutants
metaInfo = sampleInfo_Mutants
rownames(metaInfo) = sampleInfo_Mutants$SampleInfo
metaInfo$Antibody = as.factor(metaInfo$Antibody)
metaInfo$Genotype = as.factor(metaInfo$Genotype)
dds <- DESeqDataSetFromMatrix(countData = exp.data,
colData = metaInfo,
design = ~Genotype )
#Remove rows with low counts and normalise samples for visualisation
dds <- dds[ rowSums(counts(dds)) > 100, ]
dim(dds)
#Normalizing and change to 2 fold log changes.
rld <- rlog(dds)
normExpression = as.data.frame(assay(rld))
normExpression$geneID = rownames(normExpression)
normExpressionDF  = normExpression %>% gather( key = sampleName, value = rlog, -geneID)
#normExpressionDF = inner_join(normExpressionDF, sampleInfo)
ggplot(normExpressionDF, aes(x = rlog, color = sampleName)) + geom_density()
geneInfo = normExpressionDF %>%
dplyr::select(geneID, rlog, sampleName) %>%
dplyr::group_by (geneID) %>%
dplyr::summarize ( min = min(rlog),
max = max(rlog),
mean = mean(rlog),
sd = sd(rlog),
overQC = length(which(rlog > 5))
)
geneInfo.QC2 = geneInfo %>%
filter(overQC > 2)
normExpressionDF.QC = normExpressionDF %>%
filter(geneID %in% geneInfo.QC2$geneID)
ggplot(normExpressionDF.QC, aes(x = rlog, color = sampleName)) + geom_density()
normExpression.QC = normExpressionDF.QC %>%
dplyr::select(geneID, sampleName, rlog) %>%
spread(key = sampleName, value = rlog)
rownames(normExpression.QC) = normExpression.QC$geneID
normExpression.QC = normExpression.QC[, -1]
View(normExpressionDF.QC)
View(normExpressionDF)
View(normExpression.QC)
normExpression.QC = normExpression[peakInfo_QC$geneID, sampleInfo_Mutants$SampleInfo]
knitr::opts_chunk$set(echo = TRUE)
# Install required packages
#install.packages("kableExtra")
#install.packages("tidyverse")
#install.packages("RColorBrewer")
# Include the functions from the expression analysis script
source(paste(params$workingDir, params$RscriptsDir,"ExpressionAnalysisFunctions.r", sep = "/"))
library(tidyverse)
library(gplots)
library(kableExtra)
library(DESeq2)
library("viridis")
# Read in the ATACseq count data
featureCountFile = paste(params$workingDir, params$dataDir,params$count_ATAC, sep = "/")
FCdata = read.table( file = featureCountFile, header = TRUE, sep = "\t", quote = "", stringsAsFactors = FALSE)
# Save the columns with info in peak info
peakInfo  = FCdata [,1:6]
# Save the count data info in table countData
countData = FCdata[,-1:-6]
# Change row names to geneID which is saved in peakInfo
rownames(countData) = peakInfo$Geneid
# Load the sample data
sampleInfoFile = paste(params$workingDir, params$sampleInfo, sep = "/")
sampleInfo = read.table(
file = sampleInfoFile,
header = TRUE,
sep = "\t",
quote = "",
stringsAsFactors = FALSE
)
sampleInfo$bamFiles2  =  gsub(pattern = "/",
replacement = ".",
x = sampleInfo$bamFiles)
sampleInfo$bamFiles2  =  gsub(pattern = "-",
replacement = ".",
x = sampleInfo$bamFiles2)
# Rename the mutants in sampledata so that the names are universal for the data
sampleInfo$Genotype = recode(sampleInfo$Genotype, Toll910 = "Toll9")
sampleInfo$Genotype = recode(sampleInfo$Genotype, `Toll9/10` = "Toll9")
sampleInfo$Genotype = recode(sampleInfo$Genotype, gd7 = "Gd7")
# Filter out the sampleInfo that is not ATACseq
sampleInfo = sampleInfo %>% filter(Assaytype == params$Method)
#sampleInfoCountTable = data.frame(bamFiles2 = colnames(countData))
#sampleInfo = inner_join(sampleInfo, sampleInfoCountTable)
countData = countData[, sampleInfo$bamFiles2]
sampleInfo$Nuclearcycle[is.na(sampleInfo$Nuclearcycle)] = "Mutant"
colnames(countData) = sampleInfo$SampleInfo
fixedSamples = sampleInfo$SampleInfo[grep(pattern = "Fixed", x = sampleInfo$SampleInfo)]
spikedSamples = sampleInfo$SampleInfo[grep(pattern = "spiked", x = sampleInfo$SampleInfo)]
sampleInfo_Mutants = sampleInfo %>% filter(Nuclearcycle == "Mutant") %>%
filter(!SampleInfo %in% fixedSamples) %>%
filter(!SampleInfo %in% spikedSamples)
countData_mutants = countData[, sampleInfo_Mutants$SampleInfo]
exp.data = countData_mutants
metaInfo = sampleInfo_Mutants
rownames(metaInfo) = sampleInfo_Mutants$SampleInfo
metaInfo$Antibody = as.factor(metaInfo$Antibody)
metaInfo$Genotype = as.factor(metaInfo$Genotype)
dds <- DESeqDataSetFromMatrix(countData = exp.data,
colData = metaInfo,
design = ~Genotype )
#Remove rows with low counts and normalise samples for visualisation
dds <- dds[ rowSums(counts(dds)) > 100, ]
dim(dds)
#Normalizing and change to 2 fold log changes.
rld <- rlog(dds)
normExpression = as.data.frame(assay(rld))
normExpression$geneID = rownames(normExpression)
normExpressionDF  = normExpression %>% gather( key = sampleName, value = rlog, -geneID)
#normExpressionDF = inner_join(normExpressionDF, sampleInfo)
ggplot(normExpressionDF, aes(x = rlog, color = sampleName)) + geom_density()
geneInfo = normExpressionDF %>%
dplyr::select(geneID, rlog, sampleName) %>%
dplyr::group_by (geneID) %>%
dplyr::summarize ( min = min(rlog),
max = max(rlog),
mean = mean(rlog),
sd = sd(rlog),
overQC = length(which(rlog > 5))
)
geneInfo.QC2 = geneInfo %>%
filter(overQC > 2)
normExpressionDF.QC = normExpressionDF %>%
filter(geneID %in% geneInfo.QC2$geneID)
ggplot(normExpressionDF.QC, aes(x = rlog, color = sampleName)) + geom_density()
normExpression.QC = normExpressionDF.QC %>%
dplyr::select(geneID, sampleName, rlog) %>%
spread(key = sampleName, value = rlog)
rownames(normExpression.QC) = normExpression.QC$geneID
normExpression.QC = normExpression.QC[, -1]
peakInfo_QC = peakInfo %>%
dplyr::rename(geneID = Geneid) %>%
inner_join(geneInfo.QC2)
countData.QC = countData_mutants[peakInfo_QC$geneID,
sampleInfo_Mutants$SampleInfo]
normExpression.QC = normExpression[peakInfo_QC$geneID, sampleInfo_Mutants$SampleInfo]
normExpression.QC = normExpression.QC[, -1]
View(normExpression)
View(normExpression.QC)
normExpression.QC = normExpression[peakInfo_QC$geneID, sampleInfo_Mutants$SampleInfo]
View(normExpression.QC)
normExpression.QC = normExpression.QC[, -1]
normExpression.QC = normExpression[peakInfo_QC$geneID, sampleInfo_Mutants$SampleInfo]
NormalisedCountFile
## Saving normalised count file
NormalisedCountFile = paste(
params$workingDir,
params$resultsDir,
paste(params$normalisedATACpeakData, sep = "."),
sep = "/"
)
NormalisedCountFile
knitr::opts_chunk$set(echo = TRUE)
# Load the functions script (for plotting)
source(
paste(
params$workingDir,
params$RscriptsDir,
"ExpressionAnalysisFunctions.r",
sep = "/"
)
)
# Load the required packages
library(tidyverse)
library(gplots)
library(kableExtra)
library(DESeq2)
library("viridis")
# Load the sample info
sampleInfoFile = paste(params$workingDir, params$ATACresultsDir, params$ATACSampleInfo,
sep = "/")
sampleInfo = read.table(sampleInfoFile,
header = TRUE,
sep = "\t",
quote = "",
stringsAsFactors = FALSE
)
# Load the rlog values
normexpression_file = paste(params$workingDir,
params$ATACresultsDir,
params$normalisedATACpeakData,
sep = "/")
normExpression.QC = read.table(
normexpression_file,
header = TRUE,
sep = "\t",
quote = "",
stringsAsFactors = FALSE
)
# Read in the ATACseq count data
featureCountFile = paste(params$workingDir, params$dataDir, params$count_ATAC, sep = "/")
FCdata = read.table( file = featureCountFile, header = TRUE, sep = "\t", quote = "", stringsAsFactors = FALSE)
# Save the columns with info in peak info
peakInfo  = FCdata [,1:6]
# Load the PROseq data
proseq_file = paste(params$workingDir, params$PROseq.data, sep ="/")
PROseq.data = read.table(file = proseq_file, header = TRUE, sep="\t", quote="", stringsAsFactors = FALSE)
plotSample2SampleDistance(normExpression.QC)
#'  __Figure 1 Plotting sample to sample distance__ .
#'  0 means that they are identical and 1 means that they are totally different.
#'  The darker the blue the more similar. Also dendogram shows how similar they are.
#'
#' Samples do not cluster according to pre an post op. Most likely more due to difference in mapping (technical problem)
#'
#' #### PCA analysis
#' Running PCA on the samples and plotting the different variables to see which of the parameters that fit the different components the best.
#'
#' First checking how much the different PC contribute.
# Principal component analysis
mir.pca <- prcomp(t(normExpression.QC), center = TRUE, scale = FALSE)
e.var = (mir.pca[['sdev']]^2 / sum(mir.pca[['sdev']]^2))
e.var = as.data.frame( e.var )
e.var$PC = as.factor(1:nrow(e.var))
e.var$Variance = e.var$e.var*100
e.var$CumulativeVariance = cumsum(e.var$Variance)
qplot(PC, Variance, data=e.var, geom = c("point")
, ylim = c(0,max(e.var$Variance)+5)
,ylab = "Variance (%)")
#'  __Figure 2 Plotting PCA variance__.
#'  Displays how much each of the PC contributes to the overall expression.
#'  This suggest that the two first PC explains most of the variation.
#'
#+ save2, include=FALSE
#ggsave(paste(params$workingDirectory,params$resultsDirectory, "PCAvariance.png", sep = "/"))
#'
#'
# Save the loading scores from the PCA
pctable = as.data.frame(mir.pca$x)[, 1:5]
# Merge the loading scores with
pctable = cbind(pctable, sampleInfo)
test  = plotPCAplot(PCAinfo = pctable, n.comp = 4,
varianceInfo = e.var,
colorComponent = "Genotype",pchComponent = "Time"
)
test
mean = pctable %>% dplyr::select(PC1,PC2,PC3,Genotype) %>%
dplyr::group_by(Genotype) %>%
dplyr::summarise(PC1 = mean(PC1) ,PC2 = mean(PC2), PC3 = mean(PC3) )
meantime = pctable %>% dplyr::select(PC1,PC2,PC3,Time) %>%
dplyr::group_by(Time) %>%
dplyr::summarise(PC1 = mean(PC1) ,PC2 = mean(PC2), PC3 = mean(PC3) )
origo = data.frame(PC1=0,PC2=0, PC3 = 0)
line.gd7 = rbind(mean[1,2:4],origo,-mean[1,2:4])
line.gd7$factor = "Gd7"
line.toll10b = rbind(mean[2,2:4],origo,-mean[2,2:4])
line.toll10b$factor = "Toll10B"
line.toll9 = rbind(mean[3,2:4],origo,-mean[3,2:4])
line.toll9$factor = "Toll9"
line.time = rbind(-meantime[1,2:4],origo,meantime[1,2:4])
line.time$factor = "Time"
line = rbind(line.gd7,line.toll10b,line.toll9)
ggplot(line, mapping = aes(x = PC2,y = PC3, color = factor))+ geom_line() + geom_point(data = pctable,  mapping = aes(x = PC2,y = PC3, color = Genotype, shape = Time))
ggplot(line, mapping = aes(x = PC1,y = PC2, color = factor))+ geom_line() + geom_point(data = pctable,  mapping = aes(x = PC1,y = PC2, color = Genotype, shape = Time))
ggplot(line, mapping = aes(x = PC1,y = PC3, color = factor))+ geom_line() + geom_point(data = pctable,  mapping = aes(x = PC1,y = PC3, color = Genotype, shape = Time))
# Saves the loading scores for PC1-PC3
line = rbind(line.gd7,line.toll10b,line.toll9, line.time)
loadings =mir.pca$rotation[,1:3]
# Converts the loading values by subtracting the column(PC) mean and dividing by the column(PC) standard deviation. The columns needs to be transposed to rows to calculate and are then transposed back to columns
loadings_norm = as.data.frame(t((t(loadings)-colMeans(loadings))/colSds(loadings)))
loadings_norm$Geneid = rownames(loadings)
loadings_new = loadings_norm
dist3d(b =as.numeric(line[1,]),
c = as.numeric(line1[3,]),
point = as.numeric(loadings_norm[i,1:3]))
dist3d(b =as.numeric(line[1,]),
c = as.numeric(line[3,]),
point = as.numeric(loadings_norm[i,1:3]))
i = 1
dist3d(b =as.numeric(line[1,]),
c = as.numeric(line[3,]),
point = as.numeric(loadings_norm[i,1:3]))
for(j in unique(line$factor)){
loadings_new[[j]]=0
for(i in 1:nrow(loadings_norm)){
line1 = line %>% dplyr::filter(factor == j) %>% dplyr::select(PC1,PC2,PC3)
loadings_new[i,j] = dist3d(b =as.numeric(line1[1,]),
c = as.numeric(line1[3,]),
point = as.numeric(loadings_norm[i,1:3]))
}
}
